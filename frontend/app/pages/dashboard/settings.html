{% extends "pages/dashboard/layout.html" %}

{% block dashboard_content %}
<div class="flex flex-col gap-6 p-4 max-w-5xl">
    <div class="mb-2">
        <h1 class="text-3xl font-bold text-secondary-100 flex items-center gap-3">
            <i class="fa-solid fa-sliders text-primary"></i>
            OSSEC Configuration
        </h1>
        <p class="text-secondary-400 mt-1">Manage monitored paths, syscheck, and global settings</p>
    </div>

    <!-- Monitored Paths -->
    <section class="w-full py-5 px-5 bg-secondary-800 rounded-xl border border-secondary-700 shadow-lg">
        <div class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-folder-tree text-accent-info text-xl"></i>
            <h2 class="text-xl font-bold text-secondary-100">Monitored Paths</h2>
        </div>
        <p class="text-secondary-400 text-sm mb-4">Directories OSSEC monitors for file integrity. Add or remove paths below.</p>
        <form action="/dashboard/settings/monitored-paths/add" method="post" class="flex flex-wrap gap-2 mb-4">
            <input
                type="text"
                name="path"
                required
                placeholder="/path/to/directory"
                class="flex-1 min-w-[220px] px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary text-sm font-mono"
            >
            <button type="submit" class="px-4 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm hover:bg-primary/90 transition flex items-center gap-2">
                <i class="fa-solid fa-plus"></i>
                Add Path
            </button>
        </form>
        <div class="flex flex-col gap-2 max-h-48 overflow-y-auto">
            {% if monitored_paths %}
                {% for path in monitored_paths %}
                <div class="flex items-center justify-between gap-3 py-2 px-3 rounded-lg bg-secondary-900/60 border border-secondary-700 group hover:border-secondary-600 transition">
                    <span class="font-mono text-secondary-200 text-sm truncate flex-1" title="{{ path }}">{{ path }}</span>
                    <form action="/dashboard/settings/monitored-paths/remove" method="post" class="inline">
                        <input type="hidden" name="path" value="{{ path }}">
                        <button type="submit" class="p-2 rounded text-secondary-400 hover:text-accent-error hover:bg-accent-error/10 transition" title="Remove path">
                            <i class="fa-solid fa-trash-can text-sm"></i>
                        </button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-secondary-500 text-sm py-4 italic">No monitored paths configured</p>
            {% endif %}
        </div>
    </section>

    <!-- Ignored Paths -->
    <section class="w-full py-5 px-5 bg-secondary-800 rounded-xl border border-secondary-700 shadow-lg">
        <div class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-ban text-accent-warning text-xl"></i>
            <h2 class="text-xl font-bold text-secondary-100">Ignored Paths</h2>
        </div>
        <p class="text-secondary-400 text-sm mb-4">Paths excluded from integrity monitoring (e.g. logs, caches).</p>
        <form action="/dashboard/settings/ignored-paths/add" method="post" class="flex flex-wrap gap-2 mb-4">
            <input
                type="text"
                name="path"
                required
                placeholder="/path/to/ignore"
                class="flex-1 min-w-[220px] px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary text-sm font-mono"
            >
            <button type="submit" class="px-4 py-2.5 rounded-lg bg-accent-warning/20 text-accent-warning border border-accent-warning/50 font-semibold text-sm hover:bg-accent-warning/30 transition flex items-center gap-2">
                <i class="fa-solid fa-plus"></i>
                Add Ignore
            </button>
        </form>
        <div class="flex flex-col gap-2 max-h-48 overflow-y-auto">
            {% if ignored_paths %}
                {% for path in ignored_paths %}
                <div class="flex items-center justify-between gap-3 py-2 px-3 rounded-lg bg-secondary-900/60 border border-secondary-700 group hover:border-secondary-600 transition">
                    <span class="font-mono text-secondary-200 text-sm truncate flex-1" title="{{ path }}">{{ path }}</span>
                    <form action="/dashboard/settings/ignored-paths/remove" method="post" class="inline">
                        <input type="hidden" name="path" value="{{ path }}">
                        <button type="submit" class="p-2 rounded text-secondary-400 hover:text-accent-error hover:bg-accent-error/10 transition" title="Remove path">
                            <i class="fa-solid fa-trash-can text-sm"></i>
                        </button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-secondary-500 text-sm py-4 italic">No ignored paths configured</p>
            {% endif %}
        </div>
    </section>

    <!-- Path Attributes -->
    <section class="w-full py-5 px-5 bg-secondary-800 rounded-xl border border-secondary-700 shadow-lg">
        <div class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-tags text-primary text-xl"></i>
            <h2 class="text-xl font-bold text-secondary-100">Path Attributes</h2>
        </div>
        <p class="text-secondary-400 text-sm mb-4">Set attributes on monitored directories (e.g. realtime, check_all).</p>
        <form action="/dashboard/settings/monitored-paths/attribute" method="post" class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <input
                type="text"
                name="path"
                required
                placeholder="Path (e.g. /etc)"
                class="px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm font-mono"
            >
            <input
                type="text"
                name="attr"
                required
                placeholder="Attribute (e.g. realtime)"
                class="px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm font-mono"
            >
            <div class="flex gap-2">
                <input
                    type="text"
                    name="value"
                    required
                    placeholder="Value (e.g. yes)"
                    class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm font-mono"
                >
                <button type="submit" class="px-4 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm hover:bg-primary/90 transition">
                    Apply
                </button>
            </div>
        </form>
    </section>

    <!-- Syscheck Settings -->
    <section class="w-full py-5 px-5 bg-secondary-800 rounded-xl border border-secondary-700 shadow-lg">
        <div class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-magnifying-glass-chart text-accent-success text-xl"></i>
            <h2 class="text-xl font-bold text-secondary-100">Syscheck Settings</h2>
        </div>
        <p class="text-secondary-400 text-sm mb-4">Configure syscheck scan frequency and behavior.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Frequency (seconds)</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="frequency">
                    <input
                        type="text"
                        name="value"
                        value="{{ syscheck_frequency | default('43200') }}"
                        placeholder="43200"
                        class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm"
                    >
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Scan Time</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="scan_time">
                    <input
                        type="text"
                        name="value"
                        value="{{ syscheck_scan_time | default('') }}"
                        placeholder="e.g. 02:00"
                        class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm"
                    >
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Scan Day (e.g. sunday)</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="scan_day">
                    <input
                        type="text"
                        name="value"
                        value="{{ syscheck_scan_day | default('') }}"
                        placeholder="sunday"
                        class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm"
                    >
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Auto Ignore (seconds)</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="auto_ignore">
                    <input
                        type="text"
                        name="value"
                        value="{{ syscheck_auto_ignore | default('') }}"
                        placeholder="e.g. 3600"
                        class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm"
                    >
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Alert New Files</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="alert_new_files">
                    <select name="value" class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm">
                        <option value="yes" {% if syscheck_alert_new_files == 'yes' %}selected{% endif %}>Yes</option>
                        <option value="no" {% if syscheck_alert_new_files == 'no' %}selected{% endif %}>No</option>
                        <option value="" {% if not syscheck_alert_new_files %}selected{% endif %}>(not set)</option>
                    </select>
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Scan on Start</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="scan_on_start">
                    <select name="value" class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm">
                        <option value="yes" {% if syscheck_scan_on_start == 'yes' %}selected{% endif %}>Yes</option>
                        <option value="no" {% if syscheck_scan_on_start == 'no' %}selected{% endif %}>No</option>
                        <option value="" {% if not syscheck_scan_on_start %}selected{% endif %}>(not set)</option>
                    </select>
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Skip NFS</label>
                <form action="/dashboard/settings/syscheck" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="skip_nfs">
                    <select name="value" class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm">
                        <option value="yes" {% if syscheck_skip_nfs == 'yes' %}selected{% endif %}>Yes</option>
                        <option value="no" {% if syscheck_skip_nfs == 'no' %}selected{% endif %}>No</option>
                        <option value="" {% if not syscheck_skip_nfs %}selected{% endif %}>(not set)</option>
                    </select>
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Global Settings -->
    <section class="w-full py-5 px-5 bg-secondary-800 rounded-xl border border-secondary-700 shadow-lg">
        <div class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-globe text-primary text-xl"></i>
            <h2 class="text-xl font-bold text-secondary-100">Global Settings</h2>
        </div>
        <p class="text-secondary-400 text-sm mb-4">Configure global OSSEC options.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">JSON Output</label>
                <form action="/dashboard/settings/global" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="jsonout_output">
                    <select name="value" class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm">
                        <option value="1" {% if global_jsonout_output == '1' %}selected{% endif %}>Enabled</option>
                        <option value="0" {% if global_jsonout_output == '0' %}selected{% endif %}>Disabled</option>
                        <option value="" {% if not global_jsonout_output %}selected{% endif %}>(not set)</option>
                    </select>
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Alerts Log</label>
                <form action="/dashboard/settings/global" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="alerts_log">
                    <input
                        type="text"
                        name="value"
                        value="{{ global_alerts_log | default('') }}"
                        placeholder="e.g. /var/log/alerts.log"
                        class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm font-mono"
                    >
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Log All</label>
                <form action="/dashboard/settings/global" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="logall">
                    <select name="value" class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm">
                        <option value="yes" {% if global_logall == 'yes' %}selected{% endif %}>Yes</option>
                        <option value="no" {% if global_logall == 'no' %}selected{% endif %}>No</option>
                        <option value="" {% if not global_logall %}selected{% endif %}>(not set)</option>
                    </select>
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
            <div>
                <label class="block text-secondary-300 text-sm font-medium mb-1">Log All (JSON)</label>
                <form action="/dashboard/settings/global" method="post" class="flex gap-2">
                    <input type="hidden" name="tag" value="logall_json">
                    <select name="value" class="flex-1 px-4 py-2.5 rounded-lg bg-secondary-900 text-secondary-100 border border-secondary-600 focus:outline-none focus:border-primary text-sm">
                        <option value="yes" {% if global_logall_json == 'yes' %}selected{% endif %}>Yes</option>
                        <option value="no" {% if global_logall_json == 'no' %}selected{% endif %}>No</option>
                        <option value="" {% if not global_logall_json %}selected{% endif %}>(not set)</option>
                    </select>
                    <button type="submit" class="px-3 py-2.5 rounded-lg bg-primary text-secondary-900 font-semibold text-sm">Save</button>
                </form>
            </div>
        </div>
    </section>

    <p class="text-lg mt-2">
        <i class="fa-solid fa-circle-info mr-1"></i>
        Changes are applied immediately and OSSEC is restarted. A config backup is created before each change.
    </p>
</div>
{% endblock %}
